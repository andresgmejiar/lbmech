<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate a velocity function from data — getVelocity • lbmech</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate a velocity function from data — getVelocity"><meta property="og:description" content="Calculate the velocity function for an animal from (x,y,z,t) data
such as from GPS collars, assuming a function of form Tobler (see ####)."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lbmech</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/movement.html">1. Movement Models</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate a velocity function from data</h1>
    
    <div class="hidden name"><code>getVelocity.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculate the velocity function for an animal from <em>(x,y,z,t)</em> data
such as from GPS collars, assuming a function of form Tobler (see ####).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">getVelocity</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  degs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  dl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  z <span class="op">=</span> <span class="st">"z"</span>,</span>
<span>  dt <span class="op">=</span> <span class="st">"dt"</span>,</span>
<span>  ID <span class="op">=</span> <span class="st">"ID"</span>,</span>
<span>  tau <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tau_vmax <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  tau_nlrq <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  k_init <span class="op">=</span> <span class="fl">3.5</span>,</span>
<span>  s_init <span class="op">=</span> <span class="op">-</span><span class="fl">0.05</span>,</span>
<span>  v_min <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  v_lim <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  slope_lim <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  tile_id <span class="op">=</span> <span class="st">"TILEID"</span>,</span>
<span>  vals <span class="op">=</span> <span class="st">"location"</span>,</span>
<span>  dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dtVelocity</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>A data.frame or something coercible to a data.table containing
all observations</p></dd>


<dt>x</dt>
<dd><p>A character string representing the data column containing the 'x'
coordinates in meters or degrees. Ignored if data is of class SpatVector
or Spatial, and ignored for distance calculations if <code>dl</code> is
provided but required to extract elevations if <code>z</code> is of class
Raster* or SpatialPolygonsDataFrame.</p></dd>


<dt>y</dt>
<dd><p>A character string representing the data column containing the 'y'
coordinates in meters or degrees. Ignored if data is of class SpatVector
or Spatial, and ignored for distance calculations if <code>dl</code> is
provided but required to extract elevations if <code>z</code> is of class SpatRaster,
Raster*, or SpatVector, SpatialPolygonsDataFrame.</p></dd>


<dt>degs</dt>
<dd><p>Logical. If FALSE, the <code>getVelocity</code> proceeds as if the
input coordinates are meters in a projected coordinate system. If 
TRUE, assumes the input coordinates are decimal degrees in lat/long, with
<code>x</code> giving the longitude column name and <code>y</code> the latitude. See
<code><a href="https://rdrr.io/pkg/geosphere/man/distGeo.html" class="external-link">distGeo</a></code>.</p></dd>


<dt>dl</dt>
<dd><p>A character string representing the data column containing the
net displacement between this observation and the previous in meters. Optional.</p></dd>


<dt>z</dt>
<dd><p>Either a character string, a SpatRaster or Raster*, or a SpatVector
object. If character string, it represents the data column containing the 'z'
coordinates/elevations in meters. If a SpatRaster or Raster*, a DEM containing
the elevation in meters. If SpatVector, it must represent the
sectors and filepaths/URLs corresponding to the region's elevations
(see the output of <code><a href="makeGrid.html">makeGrid</a></code>).</p></dd>


<dt>dt</dt>
<dd><p>A character string representing the data column containing the
time difference from the previous observation in seconds.</p></dd>


<dt>ID</dt>
<dd><p>A character string representing the data column containing the
unique ID for each observed trajectory. In other words, each set of points
for each continuous observation for each observed individual would merit a
unique id.</p></dd>


<dt>tau</dt>
<dd><p>A number between 0 and 1, representing a global cutoff
value for <code>tau_vmax</code> and <code>tau_nlrq</code>. Ignored if the latter two are provided.</p></dd>


<dt>tau_vmax</dt>
<dd><p>A number between 0 and 1, representing the percentile at which
the maximum velocity is calculated. In other words, if <code>tau_vmax = 0.95</code> (the default),
the maximum velocity will be at the 99.5th percentile of all observations.</p></dd>


<dt>tau_nlrq</dt>
<dd><p>A number between 0 and 1, representing the percentile at which
the nonlinear regression is calculated. In other words, if <code>tau_nlrq = 0.50</code> (the default),
the total curve will attempt to have at each interval 5% of the observations above the
regression and 95% below.</p></dd>


<dt>k_init</dt>
<dd><p>A number representing the value for the topographic sensitivity
at which to initiate the nonlinear regression. Default is <code>k_init = 3.5</code>.</p></dd>


<dt>s_init</dt>
<dd><p>A number representing the value for dimensionless slope of
maximum velocity at which to initiate the nonlinear regression. Default is
<code>s_init = -0.05</code>.</p></dd>


<dt>v_min</dt>
<dd><p>The maximum velocity that will be considered. Any value equal to or
below this will be excluded from the regression. Default is <code>v_lim = 0</code>.</p></dd>


<dt>v_lim</dt>
<dd><p>The maximum velocity that will be considered. Any value above
this will be excluded from the regression. Default is <code>v_lim = Inf</code>,
but it should be set to an animal's maximum possible velocity.</p></dd>


<dt>slope_lim</dt>
<dd><p>the maximum angle that will be considered. Any value
above this will be excluded from the regression. Default is <code>slope_lim = 1</code>.</p></dd>


<dt>tile_id</dt>
<dd><p>a character string representing the name of the column
in the <code>z</code> polygon containing the unique Tile IDs. Ignored if elevations are
provided as a column or Raster*. Otherwise default is <code>tile_id = 'TILEID'</code>.</p></dd>


<dt>vals</dt>
<dd><p>A character string or a Raster* object. Required only if the
<code>z</code> parameter is a polygon NOT the output of the 
<code><a href="makeGrid.html">makeGrid</a></code> function as the default is
the character string <code>'location'</code>. If not, the <code>vals</code> parameter should be
set to the column name containing the URL or file path to the DEM for that
sector.</p></dd>


<dt>dir</dt>
<dd><p>A filepath to the directory being used as the workspace.
Default is <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code> but unless the analyses will only be performed a few
times it is highly recommended to define a permanent workspace.</p></dd>


<dt>...</dt>
<dd><p>Additional parameters to pass to <code><a href="importMap.html">importMap</a></code>.
Ignored unless <code>z</code> is a polygon pointing to source dem files.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list, containing the following entries:</p>


<p>(1) <code>$model</code>, containing an object of class <code><a href="https://rdrr.io/pkg/quantreg/man/nlrq.html" class="external-link">nlrq</a></code> containing the output
model from the nonlinear quantitative regression.</p>


<p>(2) <code>$vmax</code>, containing the identified maximum velocity.</p>


<p>(3) <code>$s</code>, containing the identified angle of maximum velocity.</p>


<p>(4) <code>$k</code>, containing the identified topographic sensitivity factor.</p>


<p>(5) <code>$tau_max</code>, containing the employed tau_max.</p>


<p>(6) <code>$tau_nlrq</code>, containing the employed tau_nlrq.</p>


<p>(7) <code>$data</code>, containing a data.table with the original data in a standardized format</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p><code>dtVelocity</code> is a wrapper for <code>getVelocity</code> for use 
inside of a data.table with observations from multiple sources
(be it different individual animals and/or different instances
from the same animal). In a <code><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code>,
use this function in the <code>j</code> slot, passing it along <code>.SD</code>.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Note that the output results should be senseless since they</span></span></span>
<span class="r-in"><span><span class="co"># are computed on random data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example 1:</span></span></span>
<span class="r-in"><span><span class="co"># If the data contains an 'elevation' or 'z' column</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fl">10000</span>,<span class="fl">20000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fl">30000</span>,<span class="fl">40000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   elevation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fl">0</span>,<span class="fl">200</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   dt <span class="op">=</span> <span class="fl">120</span>,</span></span>
<span class="r-in"><span>                   ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,each<span class="op">=</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">velocity</span> <span class="op">&lt;-</span> <span class="fu">getVelocity</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, z <span class="op">=</span> <span class="st">'elevation'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Example 2:</span></span></span>
<span class="r-in"><span><span class="co"># If the data do not contain elevation, and 'z' is a raster</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span> <span class="va">data</span><span class="op">[</span>, <span class="va">z</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               x        y  elevation  dt ID</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1: 19197.95 31660.38   5.360886 120  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     2: 13874.84 30819.55  15.969853 120  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     3: 13259.93 30059.33  40.255143 120  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4: 13926.57 35945.80 191.091049 120  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5: 13583.44 37005.09  47.189854 120  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ---                                    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9996: 14462.01 31778.87  46.747152 120 10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9997: 12468.17 37831.73 100.501198 120 10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9998: 12850.95 31249.34  96.181285 120 10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9999: 11615.92 30343.52  29.586331 120 10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10000: 10287.85 33540.86 146.470682 120 10</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate a DEM</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span></span></span>
<span class="r-in"><span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu">as.data.table</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dem</span><span class="op">[</span>, <span class="va">z</span> <span class="op">:=</span> <span class="fl">250</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span>      <span class="fl">250</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            x    y         z</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      1: 0.01 0.01 1.0146139</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      2: 0.02 0.01 1.0404641</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      3: 0.03 0.01 1.0675194</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      4: 0.04 0.01 1.0958300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      5: 0.05 0.01 1.1254477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ---                    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 249996: 4.96 5.00 1.0711366</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 249997: 4.97 5.00 1.0428260</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 249998: 4.98 5.00 1.0157707</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 249999: 4.99 5.00 0.9899205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 250000: 5.00 5.00 0.9652271</span>
<span class="r-in"><span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">ext</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10000</span>, <span class="fl">20000</span>, <span class="fl">30000</span>, <span class="fl">40000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">crs</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"+proj=lcc +lat_1=48 +lat_2=33 +lon_0=-100 +datum=WGS84"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">velocity</span> <span class="op">&lt;-</span> <span class="fu">getVelocity</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, z <span class="op">=</span> <span class="va">dem</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Example 3:</span></span></span>
<span class="r-in"><span><span class="co"># If the data do not contain elevation, and 'z' is a sector grid pointing</span></span></span>
<span class="r-in"><span><span class="co"># to file locations</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Export the DEM so it's not just stored on the memory</span></span></span>
<span class="r-in"><span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">writeRaster</span><span class="op">(</span><span class="va">dem</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir</span>,<span class="st">"/DEM.tif"</span><span class="op">)</span>,overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Import raster, get the grid</span></span></span>
<span class="r-in"><span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir</span>,<span class="st">"/DEM.tif"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="makeGrid.html">makeGrid</a></span><span class="op">(</span>dem <span class="op">=</span> <span class="va">dem</span>, nx <span class="op">=</span> <span class="va">n</span>, ny <span class="op">=</span> <span class="va">n</span>, sources <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">velocity</span> <span class="op">&lt;-</span> <span class="fu">getVelocity</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, z <span class="op">=</span> <span class="va">grid</span>, dir <span class="op">=</span> <span class="va">dir</span>, res <span class="op">=</span> <span class="fu">res</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_04 (1 of 4)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_05 (2 of 4)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_09 (3 of 4)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_10 (4 of 4)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_01 (1 of 5)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_02 (2 of 5)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_06 (3 of 5)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_07 (4 of 5)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_03 (5 of 5)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_13 (1 of 3)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_16 (2 of 3)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_17 (3 of 3)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_21 (1 of 3)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_22 (2 of 3)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_23 (3 of 3)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_15 (1 of 5)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_19 (2 of 5)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_20 (3 of 5)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_24 (4 of 5)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Cropping Tile SECTOR_25 (5 of 5)"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#' # Example 4:</span></span></span>
<span class="r-in"><span><span class="co"># If you want to get the values by group within a data.table</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate fake data with x,y coordinates, z elevation, and a t</span></span></span>
<span class="r-in"><span><span class="co"># column representing the number of seconds into the observation</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fl">10000</span>,<span class="fl">20000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fl">30000</span>,<span class="fl">40000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fl">0</span>,<span class="fl">200</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   dt <span class="op">=</span> <span class="fl">15</span>,</span></span>
<span class="r-in"><span>                   ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,each<span class="op">=</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>                   </span></span>
<span class="r-in"><span><span class="co"># To get the velocity function for all observations together</span></span></span>
<span class="r-in"><span><span class="va">v1</span> <span class="op">&lt;-</span> <span class="fu">getVelocity</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This is the same as above, but it only returns a list with the </span></span></span>
<span class="r-in"><span><span class="co"># coefficients and p-values</span></span></span>
<span class="r-in"><span><span class="va">v2</span> <span class="op">&lt;-</span> <span class="fu">dtVelocity</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Instead this function is best to get the coefficients for </span></span></span>
<span class="r-in"><span><span class="co"># each individual track un a data.table using .SD</span></span></span>
<span class="r-in"><span><span class="va">v3</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="fu">dtVelocity</span><span class="op">(</span><span class="va">.SD</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">'ID'</span>, .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">]</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Andres G. Mejia Ramon.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

