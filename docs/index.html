<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Package to Study the Mechanics of Landscape and Behavior • lbmech</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="A Package to Study the Mechanics of Landscape and Behavior">
<meta property="og:description" content="A series of functions to calculate the cost required to move across the landscape in terms of (1) time, (2) mechanical work, and (3) net metabolic expenditure---energy, as well as (4) estimate local indicators of dispersion. ">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">lbmech</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/movement.html">1. Movement Models</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<ul>
<li>
<a href="#lbmech">lbmech</a>
<ul>
<li><a href="#installation">Installation</a></li>
<li>
<a href="#example-workflow">Example Workflow</a>
<ul>
<li><a href="#part-1-topographic-data-sources">Part 1: Topographic Data Sources</a></li>
<li><a href="#part-2-velocity-data-sources">Part 2: Velocity Data Sources</a></li>
<li><a href="#part-3-preparing-the-world">Part 3: Preparing the World</a></li>
<li><a href="#part-4-getting-costs-paths-and-corridors">Part 4: Getting Costs, Paths, and Corridors</a></li>
</ul>
</li>
<li>
<a href="#quick-start">Quick Start</a>
<ul>
<li><a href="#for-energetic-and-temporal-cost-calculations">For Energetic and Temporal Cost Calculations</a></li>
<li><a href="#custom-cost-functions-and-multivariate-costs">Custom Cost Functions and Multivariate Costs</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- README.md is generated from README.Rmd. Please edit that file --><p><img src="reference/figures/logo.png" align="right" height="139"></p>
<div class="section level1">
<div class="page-header"><h1 id="lbmech">lbmech<a class="anchor" aria-label="anchor" href="#lbmech"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p><code>lbmech</code> is a geospatial package for least-cost path analysis in <code>R</code>. It contains additional tools to calculate time- and energy-based costs-of-travel for humans and animals moving across the landscape. The general philosophy behind this package is that least-cost path analyses should always be simple, the most time-taking parts should be done at most once, and ideally that costs should be rooted in empirical reality.</p>
<p>In general terms, both <code>lbmech</code> and the deterministic functions of the library <code>gdistance</code> provide similar capabilities but with notable differences in computation and ease-of-use.<code>gdistance</code> stores movement costs as their reciprocal (<em>conductance</em> , i.e. <embed src="https://latex.codecogs.com/png.latex?1%2F%5Ctextrm%7Bresistance%7D" title="1/\textrm{resistance}"></embed>) in a sparse matrix representing every possible transition between two cells on a raster. The use of conductance allows for most cell-to-cell transitions to be zero, since impossible transitions due to distance have a conductance of <embed src="https://latex.codecogs.com/png.latex?1%2F%5Cinfty%20%3D%200" title="1/\infty = 0"></embed>. However, the use of conductance makes it cumbersome to employ functions where f(0) != 0, requiring the use of index masking. This in turn encounters integer overflow errors with ‘large’ datasets that are nonetheless of a necessary size for most reasonable purposes.</p>
<p><code>lbmech</code> stores data and performs all linear algebra directly on resistance values using the <code>data.table</code> package. Not only is this more intuitive, but it greatly simplifies the syntax necesary for many types of algebraically simple operations. <code>lbmech</code> storrd each possible movement as its own unique row, with entries for a <code>from</code> node, a <code>to</code> node, and either the difference in or raw final and initial values of the raster encountered during the transition. Nodes are named after the coordinates of the raster cell to which they correspond, and are stored as character strings in the form <code>'x,y'</code>. This allows for (1) in-place modification of objects, greatly increasing processing speed; (2) bidirectional raster analysis describing accumulated costs to and from a node, and (3) additive, nonlinear, and multivariate transformations of large rasters and independent considerations without running into integer overflow limits. Since <code>lbmech</code> in the end is just a wrapper for applying <code>data.table</code> and <code>igraph</code> functions to rasters, it’s easy to generate any arbitrary cost function using <code>data.table</code> syntax.</p>
<p>To ensure that the most computationally intensive steps only need to be performed once for many repeated analyses, <code>lbmech</code> also modularizes important aspects of the cost-distance workflow. This allows for ootherwise prohibitively-large spatial regions and fine spatial resolutions to be considered. This is arguably necessary when land-based transport requires decision-making to be made at scales on the order of 1-10 m. Files by default are stored in the temporary directory, however if it’s expected that the particular procedure will be repeated again after <code>R</code> is reinitialized it is <em>highly</em> recommended to designate a consistent workspace directory in the <code>dir</code> parameter of most functions for each time <code>makeWorld</code> (or a function that depends on it) is called with new parameters. This ensures that each world only needs to be generated <em>once</em>.</p>
<p>Finally, to encourage the use of least-cost analysis rooted in empirical reality, <code>lbmech</code>’s default workflow is geared towards the study of time- and energy- based considerations when moving across a landscape (although the use of any cost function is possible as well). Unlike similar tools such as <code>enerscape</code> for <code>R</code> in this regard, <code>lbmech</code> allows for the estimation of various types of energetic losses (due to kinematic locomotion, work against gravity, basal metabolic processes) instead of simply the total energetic or metabolic expenditure. Moreover, through the <code>getVelocity</code> function it provides a way of deriving cost functions from GPS data of human and animal movement. This is significantly less invasive than the VO<sub>2</sub> meters required for direct estimation of net energetic expenditure.</p>
<p>The workflow demonstrated in this README provides a detailed guide for a hypothetical analysis of least-cost energetic analysis employing the examples included in the individual function documentation and generating all data from scratch. For most purposes, only five or six function calls to the package are necessary. A ‘quick start’ guide summarizing the README example in as few function calls as possible is provided at the end of this file. Please note that all units are in SI: Kilograms for mass, meters for length, Joules for energy, seconds for time.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"andresgmejiar/lbmech"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-workflow">Example Workflow<a class="anchor" aria-label="anchor" href="#example-workflow"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">lbmech</span><span class="op">)</span></span>
<span><span class="co"># Set random seed for reproducibility's sake</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">75291</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="part-1-topographic-data-sources">Part 1: Topographic Data Sources<a class="anchor" aria-label="anchor" href="#part-1-topographic-data-sources"></a>
</h3>
<p>The first step in a typical <code>lbmech</code> workflow is defining the digital elevation model (DEM) to define as the topographic data source. This may be provided in one of two ways:</p>
<ol style="list-style-type: decimal">
<li>A RasterLayer object representing the digital elevation model for the region-of-interest
<ul>
<li>In order to ensure that there is a stable file path to the source DEM throughout the workflow, the raster must have been ‘read in’ using the <code>raster</code> function without having been further modified. If additional modifications are necessary, use the <code>writeRaster</code> function to save it to the disk first before re-reading it in using <code>raster</code>. For example:</li>
</ul>
</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a DEM</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>                        y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span></span>
<span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu">as.data.table</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span>
<span><span class="va">dem</span><span class="op">[</span>, <span class="va">z</span> <span class="op">:=</span> <span class="fl">250</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fl">250</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu">rasterFromXYZ</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span>
<span><span class="fu">extent</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10000</span>, <span class="fl">20000</span>, <span class="fl">30000</span>, <span class="fl">40000</span><span class="op">)</span></span>
<span><span class="fu">crs</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"+proj=lcc +lat_1=48 +lat_2=33 +lon_0=-100 +datum=WGS84"</span></span>
<span></span>
<span><span class="co"># Export it so it doesn't just exist on the memory</span></span>
<span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">writeRaster</span><span class="op">(</span><span class="va">dem</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir</span>,<span class="st">"/DEM.tif"</span><span class="op">)</span>,format<span class="op">=</span><span class="st">"GTiff"</span>,overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Import raster</span></span>
<span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir</span>,<span class="st">"/DEM.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dem</span>, main <span class="op">=</span> <span class="st">"Digital Elevation Model"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-dem-1.png" width="100%"></p>
<ol style="list-style-type: decimal">
<li>A SpatialPolygonsDataFrame object whose individual polygons represent sectors with unique DEM sources stored as a file path or URL in the data frame object. You can often find these from state agencies.
<ul>
<li>As of the most recent version, <code>lbmech</code> supports file types readible by <code>rgdal</code> and <code>raster</code>, as well as such files compressed in <code>gz</code> and <code>zip</code> files–although the latter is likely to fail in Unix systems.</li>
</ul>
</li>
</ol>
<p>Even if you have already downloaded or imported a raster to use as a topographic data source as in case one above, most of the functions will expect a SpatialPolygonsDataFrame object in the form of case two. You can make this using the <code>makeGrid</code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/makeGrid.html">makeGrid</a></span><span class="op">(</span>dem <span class="op">=</span> <span class="va">dem</span>, nx <span class="op">=</span> <span class="va">n</span>, ny <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dem</span>, main <span class="op">=</span> <span class="st">"Sectors to divide DEM"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-makeGrid-1.png" width="100%"></p>
<p><code>lbmech</code> is specifically designed to deal with <strong>large</strong> regions that would be prohibitive to analyze if the data is stored exclusively within the memory. To deal with this issue, <code>lbmech</code> will crop any input raster into an <code>nx</code> by <code>ny</code> grid and save the sector in its own <code>gz</code> file for case 1. In both cases—to save memory and computational time—sectors are only cropped or downloaded on an as-needed basis. You can use the <code>whichTiles</code> and <code>getMap</code> functions to identify which tile(s) might be needed, and download or crop any such tiles that haven’t been prepared:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate five random points that fall within the grid</span></span>
<span><span class="va">points</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fu">extent</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu">extent</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                     y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fu">extent</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fu">extent</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>               </span>
<span>                           </span>
<span><span class="co"># Run whichTiles and getMap to prepare appropriate sector files</span></span>
<span><span class="va">tile_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/whichTiles.html">whichTiles</a></span><span class="op">(</span>region <span class="op">=</span> <span class="va">points</span>, polys <span class="op">=</span> <span class="va">grid</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Loading required namespace: rgeos</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tile_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "SECTOR_24" "SECTOR_9"  "SECTOR_25" "SECTOR_18" "SECTOR_20"</span></span>
<span></span>
<span><span class="fu"><a href="reference/getMap.html">getMap</a></span><span class="op">(</span>tiles <span class="op">=</span> <span class="va">tile_list</span>, polys <span class="op">=</span> <span class="va">grid</span>, dir <span class="op">=</span> <span class="va">dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_24 (1 of 5)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_9 (2 of 5)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_25 (3 of 5)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_18 (4 of 5)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_20 (5 of 5)"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">dir</span>,recursive<span class="op">=</span><span class="cn">TRUE</span>, pattern <span class="op">=</span> <span class="st">".gz$"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Elevations/SECTOR_18.gz" "Elevations/SECTOR_20.gz" "Elevations/SECTOR_24.gz" "Elevations/SECTOR_25.gz"</span></span>
<span><span class="co">#&gt; [5] "Elevations/SECTOR_9.gz"</span></span></code></pre></div>
<p>By far the most computationally intensive part of the workflow is the first transformation of the topographic data. To calculate the distances, we will need to convert the data from a a matrix of locations (a raster) with an associated attribute (elevation) to a list of possible movements between locations (all raster cells and their neighbors) and associated attribute (difference in elevation). These are stored as <code>gz</code> files in a folder named <code>'Tensors'</code> in the workspace directory and will be later read into the memory as required to avoid having to re-calculate them every time they are needed:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select all tiles that exist between x = (12000,16000) and y = (32000,36000)</span></span>
<span><span class="va">tiles</span> <span class="op">&lt;-</span> <span class="fu">extent</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12000</span>,<span class="fl">16000</span>,<span class="fl">32000</span>,<span class="fl">36000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tiles</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="va">tiles</span>,<span class="st">"SpatialPolygons"</span><span class="op">)</span></span>
<span><span class="fu">crs</span><span class="op">(</span><span class="va">tiles</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">crs</span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span><span class="va">tiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/whichTiles.html">whichTiles</a></span><span class="op">(</span>region <span class="op">=</span> <span class="va">tiles</span>, polys <span class="op">=</span> <span class="va">grid</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/makeWorld.html">makeWorld</a></span><span class="op">(</span>tiles <span class="op">=</span> <span class="va">tiles</span>, polys <span class="op">=</span> <span class="va">grid</span>, cut_slope <span class="op">=</span> <span class="fl">0.5</span>, z_fix <span class="op">=</span> <span class="va">dem</span>, dir <span class="op">=</span> <span class="va">dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_1 (1 of 9)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_2 (2 of 9)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_3 (3 of 9)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_6 (4 of 9)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_7 (5 of 9)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_8 (6 of 9)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_11 (7 of 9)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_12 (8 of 9)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_13 (9 of 9)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_4 (1 of 2)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_14 (2 of 2)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_16 (1 of 2)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_17 (2 of 2)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_19 (1 of 1)"</span></span></code></pre></div>
<p><code>makeWorld</code> internally calls <code>getMap</code> so you do not need to prepare the data beforehand. This, however, means that you will need to either erase the created directories or define a new workspace directory and regenerate all tensors from scratch if you later on wish to change any of the parameters used in <code>makeWorld.</code>A note about the parameters. The <code>cut_slope</code> is the magnitude of the dimensionless slope beyond which movement is not possible.</p>
<p><code>z_fix</code> merits special attention since its consistency will be required for most of the later functions in the workflow.<code>lbmech</code> allows for sector-defining grids pointing to DEM sources in different coordinate reference systems, spatial resolutions, and grid origins. However, the package requires a ‘master’ raster be designated that will define the projection, spatial resolution, and grid origin to be used in the analyses. All data will be projected to these ‘fixed’ parameters. Really only the origin can be neglected from consideration, and generally to minimize space should be left at its default of zero.</p>
<p>The spatial resolution should generally be of an order of magnitude comparable to the scale of decision-making in a real-world environment. For example, a 90 m SRTM raster cell would generally result in paths much straighter than a real individual would walk, while a 0.10 cm would result in paths much curlier than a real individual would walk. Thus, for humans a reasonable resolution might be between 1-10 m, while for ants it might be between 1-5 mm. If no <code>z_fix</code> is specified, the default is a resolution of 5 m. If you wish to change this, you must make sure to include the parameter <code>res = x</code> where <code>x</code> is desired resolution in any function that requires <code>z_fix</code> or <code>proj</code> in the remainder of the workflow.</p>
<p>The raster projection should be selected to minimize distance distortion along different bearings—such as conformal projections. If your source DEM is of the appropriate resolution and projection, you can simply use the original DEM (or a constituent, if it’s multiple sources) as the <code>z_fix</code> parameter throughout. If none of these rasters are appropriate, you can make one using the <code>fix_z</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fix_z.html">fix_z</a></span><span class="op">(</span>proj   <span class="op">=</span> <span class="fu">crs</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span>,         <span class="co"># Desired projection</span></span>
<span>               res    <span class="op">=</span> <span class="fu">res</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span>,         <span class="co"># Desired resolution</span></span>
<span>               dx     <span class="op">=</span> <span class="fl">0</span>,                <span class="co"># Desired horizontal offset</span></span>
<span>               dy     <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>                <span class="co"># Desired vertical offset</span></span></code></pre></div>
<p>If you do not specify a <code>z_fix</code> parameter, the default is for the functions to assign it as <code>z_fix &lt;- fix_z(proj = proj, res = 5, dx = 0, dy = 0)</code>. The functions will generally try to figure out what the projection is, but it’s best practice to define it outside of the function (ensuring it’s confromal and in meters) and continually refer to it. In short, if a function has a <code>z_fix</code> parameter, you must ALWAYS specify either a <code>z_fix</code> OR a <code>crs</code>. If you modify both, <code>z_fix</code> takes precedence, and if you modify either of them or <code>res</code>, <code>dx</code>, or <code>dy</code> when making the <code>world</code> for the first time, you must modify them through the remainder of the workflow CONSISTENTLY.</p>
<p>Contrary to my advice, in this example we will set <code>z_fix = dem</code> since the resolution is low enough to minimize computational time.</p>
</div>
<div class="section level3">
<h3 id="part-2-velocity-data-sources">Part 2: Velocity Data Sources<a class="anchor" aria-label="anchor" href="#part-2-velocity-data-sources"></a>
</h3>
<p>The fundamental assumption behind the least-cost calculations is that humans and animals tend to prefer to walk at predictable speeds at a given slope. The maximum speed is generally achieved at one particular slope, and speed would tend to decrease exponentially as the distance to this ideal slope increases. Mathematically, this is described by Tobler’s Hiking function <embed src="https://latex.codecogs.com/png.latex?%7Bd%20%5Cell%7D%2F%7Bd%20t%7D%20%3D%20v_%7B%5Cmathrm%7Bmax%7D%7D%20e%5E%7B-k%20%7C%20%7Bd%20z%7D%20%2F%20%7Bd%20%5Cell%7D%20-%20%5Calpha%20%7C%7D%2C" title="{d \ell}/{d t} = v_{\mathrm{max}} e^{-k | {d z} / {d \ell} - \alpha |},"></embed> where <embed src="https://latex.codecogs.com/png.latex?%5Cell" title="\ell"></embed> is horizontal displacement, <embed src="https://latex.codecogs.com/png.latex?t" title="t"></embed> time, <embed src="https://latex.codecogs.com/png.latex?%7Bd%20%5Cell%7D%2F%7Bd%20t%7D" title="{d \ell}/{d t}"></embed> horizontal speed, <embed src="https://latex.codecogs.com/png.latex?v_%7B%5Cmathrm%7Bmax%7D%7D" title="v_{\mathrm{max}}"></embed> the maximum walking speed, <embed src="https://latex.codecogs.com/png.latex?%7Bd%20z%7D%2F%7Bd%20%5Cell%7D" title="{d z}/{d \ell}"></embed> the change in elevation versus the change in horizontal distance (dimensionless slope, or <embed src="https://latex.codecogs.com/png.latex?%5Carctan%20%5Ctheta" title="\arctan \theta"></embed> where <embed src="https://latex.codecogs.com/png.latex?%5Ctheta" title="\theta"></embed> is the slope in degrees or radians), <embed src="https://latex.codecogs.com/png.latex?%5Calpha" title="\alpha"></embed> the ideal slope of maximum walking speed, and <embed src="https://latex.codecogs.com/png.latex?k" title="k"></embed> a parameter controling how sensitive changes in speed are to changes in slope. Canonical applications of this function to humans set <embed src="https://latex.codecogs.com/png.latex?v_%7B%5Cmathrm%7Bmax%7D%7D%3D%201.5" title="v_{\mathrm{max}}= 1.5"></embed> m/s, <embed src="https://latex.codecogs.com/png.latex?k%20%3D%203.5" title="k = 3.5"></embed>, and <embed src="https://latex.codecogs.com/png.latex?%5Calpha%20%3D%20-0.05%20%3D%20%5Ctan%7B%28-2.83%5E%5Ccirc%29%7D" title="\alpha = -0.05 = \tan{(-2.83^\circ)}"></embed>.</p>
<p><code>lbmech</code> provides the <code>getVelocity</code> function by which these parameters can be estimated from locational data for different species. GPS data from GPX files can be imported using the <code>importGPX</code> function. Data should be structured such that there is a column with x coordinates, a column with y coordinates, a column with changes in time, and a column with a trajectory id. Note that all values must be in meters (other than <code>'dt'</code>, which must be in seconds), and the <code>'x'</code> and <code>'y'</code> coordinates in a projected coordinate system. Alternatively, <code>'x'</code> and <code>'y'</code> may represent the longitude and latitude, respectively, in decimal degrees so long as <code>degs = TRUE</code>. If columns are named anything other than <code>'x'</code>, <code>'y'</code>, <code>'dt'</code>, and <code>'id'</code>, the column names need to be declared explicitly. Elevational data is provided as the <code>z</code> parameter. This can be either a column with elevations—such as those recorded by a GPS unit—a RasterLayer representing the DEM for that region, or a SpatialPolygonsDataFrame like the output of the <code>makeGrid</code> function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate dummy GPS data</span></span>
<span><span class="co"># 10,000 observations falling within the extent of the generted DEM</span></span>
<span><span class="co"># taken at an interval of 120 seconds between observations</span></span>
<span><span class="co"># and of 10 different individuals (1000 per individual)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fu">extent</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fu">extent</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                   y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fu">extent</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,<span class="fu">extent</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                   dt <span class="op">=</span> <span class="fl">120</span>,</span>
<span>                   ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,each<span class="op">=</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">velocity</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getVelocity.html">getVelocity</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, z <span class="op">=</span> <span class="va">grid</span>, dir <span class="op">=</span> <span class="va">dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_23 (1 of 6)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_21 (2 of 6)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_10 (3 of 6)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_22 (4 of 6)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_15 (5 of 6)"</span></span>
<span><span class="co">#&gt; [1] "Cropping Tile SECTOR_5 (6 of 6)"</span></span></code></pre></div>
<p>So what happened? <code>getVelocity</code> called <code>whichTiles</code> and <code>getMap</code> to identify which tiles were needed to get the elevation for the points we generated in <code>data</code>. It then cropped and saved each tile in a folder named <code>'Elevations'</code> in the <code>dir</code>. Afterwards, it extracted the elevation for each <code>data</code> point, and performed a nonlinear quantile regression to get the appropriate parameters. Since GPS data can be noisy, <code>getVelocity</code> also allows for <code>slope_lim</code> and <code>v_lim</code> parameters to which dimensionless slope and velocity values are outliers before performing the regression.</p>
<p>The output object is a list. Since this was calculated based on random data, the calculated parameters here are meaningless but let’s have a look at the structure anyways:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">velocity</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $model</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Nonlinear quantile regression</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    model:  dl_dt ~ v_max * exp(-k * abs(dz_dl - alpha)) </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     data:  [ data (dl_dt &lt;= v_lim) &amp; abs(dz_dl) &lt;= slope_lim </span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      tau:  0.95 </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; deviance:  15513.54 </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             k         alpha </span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9.3765158628 -0.0002554502 </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $vmax</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 94.47548</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $alpha</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -0.0002554502</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $k</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 9.376516</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $tau_vmax</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.995</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $tau_nlrq</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.95</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $data</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        ID        x        y         z  dt         dx         dy         dz        dl     dl_dt        dz_dl</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     1:  1 12212.41 32529.50  91.27850 120         NA         NA         NA        NA        NA           NA</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     2:  1 11505.81 30739.54  14.78457 120  -706.5965 -1789.9575  -76.49393  1924.377 16.036474 -0.039749971</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     3:  1 15396.60 34388.33 468.68015 120  3890.7912  3648.7907  453.89558  5334.035 44.450292  0.085094225</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     4:  1 12964.58 32482.58 142.54257 120 -2432.0223 -1905.7497 -326.13757  3089.760 25.747996 -0.105554354</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     5:  1 10203.78 32573.76  58.64795 120 -2760.8021    91.1736  -83.89463  2762.307 23.019226 -0.030371216</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    ---                                                                                                     </span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9996: 10 11252.46 39152.06  10.87654 120 -7124.0611   832.2890  -19.38931  7172.514 59.770947 -0.002703279</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9997: 10 18621.13 31766.48  27.82283 120  7368.6690 -7385.5834   16.94628 10432.839 86.940323  0.001624321</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9998: 10 17874.49 32426.01  80.00574 120  -746.6408   659.5376   52.18292   996.224  8.301867  0.052380709</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9999: 10 19379.55 33973.62 194.80910 120  1505.0552  1547.6026  114.80335  2158.765 17.989706  0.053180114</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10000: 10 15913.79 36145.81 380.90640 120 -3465.7618  2172.1928  186.09731  4090.223 34.085194  0.045498080</span></span></code></pre></div>
<p>The velocity list contains seven entries:</p>
<ol style="list-style-type: decimal">
<li><p><code>$model</code>, containing an object of class <code>nlrq</code> with the output model from the nonlinear quantile regression (nlrq) structured in the form of Tobler’s function. You can treat this as any other statistical model object such as <code>lm</code>.</p></li>
<li><p><code>$vmax</code>, containing the identified maximum velocity, calculated as the <code>tau_max</code> fraction of all observed velocities.</p></li>
<li><p><code>$alpha</code>, containing the identified angle of maximum velocity, and calculated from the nlrq of Tobler’s function</p></li>
<li><p><code>$k</code>, containing the identified topographic sensitivity factor, and calculated from the nlrq of Tobler’s function.</p></li>
<li><p><code>$tau_max</code>, containing the employed <code>tau_max</code>.</p></li>
<li><p><code>$tau_nlrq</code>, containing the employed <code>tau_nlrq</code>.</p></li>
<li><p><code>$data</code>, containing a data.table with the original data in a standardized format</p></li>
</ol>
<p>Generally, the rate at which you are sampling locations should be comparable to the amount of time you would expect it would take you to travel from one cell to another. In this scenario, we can move up to <code>contiguity = 2</code> pixels away so we want to move at <code>contiguity + 1</code> pixels away. We expect to move at up to <code>v_est = 1.5</code> m/s, and each pixel has a length of <code>\code{res(dem)} = 20</code>, so we should downsample any signal that makes observations faster than <code>t_step = res(dem) / v_est * (contiguity + 1) * sqrt(2)</code> seconds. If our data is taken at a faster rate (for example, many phones record data at an interval of 1-10 seconds), we can use the <code>downsample</code> function before running the <code>getVelocity</code> function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate fake data with x,y coordinates, z elevation, and a t</span></span>
<span><span class="co"># column representing the number of seconds into the observation</span></span>
<span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fl">10000</span>,<span class="fl">20000</span><span class="op">)</span>,</span>
<span>                   y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fl">30000</span>,<span class="fl">40000</span><span class="op">)</span>,</span>
<span>                   z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fl">0</span>,<span class="fl">200</span><span class="op">)</span>,</span>
<span>                   t <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>,</span>
<span>                   ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,each<span class="op">=</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span>                   </span>
<span><span class="co"># Set the minimum value at 3 seconds</span></span>
<span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu">downsample</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data2</span>, t_step <span class="op">=</span> <span class="fl">3</span>, z <span class="op">=</span> <span class="st">'z'</span><span class="op">)</span></span>
<span><span class="va">v2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getVelocity.html">getVelocity</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data2</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can also investigate the velocity function for various sub-sets of the data. For example, let’s say that each ID represents a unique individual, and we also have another column representing different tracks followed by each individual:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate fake data with x,y coordinates, z elevation, and a t</span></span>
<span><span class="co"># column representing the number of seconds into the observation</span></span>
<span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fl">10000</span>,<span class="fl">20000</span><span class="op">)</span>,</span>
<span>                   y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fl">30000</span>,<span class="fl">40000</span><span class="op">)</span>,</span>
<span>                   z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fl">0</span>,<span class="fl">200</span><span class="op">)</span>,</span>
<span>                   dt <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                   AnimalID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,each<span class="op">=</span><span class="fl">1000</span><span class="op">)</span>,</span>
<span>                   TrackID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,each<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span>                   </span>
<span><span class="co"># To get the velocity function for all observations togther</span></span>
<span><span class="va">v1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getVelocity.html">getVelocity</a></span><span class="op">(</span><span class="va">data2</span>, ID <span class="op">=</span> <span class="st">'TrackID'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This is the same as above, but it only returns a list with the </span></span>
<span><span class="co"># coefficients and p-values</span></span>
<span><span class="va">v2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getVelocity.html">dtVelocity</a></span><span class="op">(</span><span class="va">data2</span>, ID <span class="op">=</span> <span class="st">'TrackID'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Instead this function is best to get the coefficients for </span></span>
<span><span class="co"># each individual animal un a data.table using .SD</span></span>
<span><span class="va">v3</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">[</span>, <span class="fu"><a href="reference/getVelocity.html">dtVelocity</a></span><span class="op">(</span><span class="va">.SD</span>, ID <span class="op">=</span> <span class="st">'TrackID'</span><span class="op">)</span>, </span>
<span>            by <span class="op">=</span> <span class="st">'AnimalID'</span>, .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">v3</span><span class="op">)</span></span>
<span><span class="co">#&gt;    AnimalID        k         alpha    v_max          k_p      alpha_p</span></span>
<span><span class="co">#&gt; 1:        1  3.50000 -5.000000e-02 737.4180 9.114769e-03 1.730733e-02</span></span>
<span><span class="co">#&gt; 2:        2  3.50000 -5.000000e-02 727.9875 2.385765e-02 2.018783e-02</span></span>
<span><span class="co">#&gt; 3:        3  3.50000 -5.000000e-02 750.6535 3.684702e-02 5.935256e-02</span></span>
<span><span class="co">#&gt; 4:        4  3.50000 -5.000000e-02 739.6417 4.939626e-04 1.669016e-03</span></span>
<span><span class="co">#&gt; 5:        5 17.96599 -5.704558e-05 745.5354 0.000000e+00 9.383468e-01</span></span>
<span><span class="co">#&gt; 6:        6  3.50000 -5.000000e-02 733.1121 2.134099e-07 5.002490e-07</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="part-3-preparing-the-world">Part 3: Preparing the World<a class="anchor" aria-label="anchor" href="#part-3-preparing-the-world"></a>
</h3>
<p>You’ll have noticed that <code>makeWorld</code> simply made the <code>gz</code> files in the working directory for each sector that’s required. To import them into the memory, use the <code>importWorld</code> function. It first runs <code>makeWorld</code> (which in turn calls <code>getMap</code>) to make sure each necessary sector has been prepared, and then imports ONLY the possible movements falling within a given <code>region</code> and excluding those falling within a given <code>banned</code> area:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import the data lying between x = (12000,16000) and y = (32000,36000)...</span></span>
<span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu">extent</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12000</span>,<span class="fl">16000</span>,<span class="fl">32000</span>,<span class="fl">36000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="va">region</span>,<span class="st">"SpatialPolygons"</span><span class="op">)</span></span>
<span><span class="fu">crs</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">crs</span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span></span>
<span><span class="va">world</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/importWorld.html">importWorld</a></span><span class="op">(</span>region <span class="op">=</span> <span class="va">region</span>, polys <span class="op">=</span> <span class="va">grid</span>, banned <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                     cut_slope <span class="op">=</span> <span class="fl">0.5</span>, z_fix <span class="op">=</span> <span class="va">dem</span>, dir <span class="op">=</span> <span class="va">dir</span><span class="op">)</span></span></code></pre></div>
<p>Let’s have a look at what the <code>world</code> data.table looks like:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span></span>
<span><span class="co">#&gt;           from          to         dz</span></span>
<span><span class="co">#&gt; 1: 12010,34130 12030,34130  0.8184357</span></span>
<span><span class="co">#&gt; 2: 12010,34130 12010,34110 -1.7999878</span></span>
<span><span class="co">#&gt; 3: 12010,34130 12030,34110 -0.9815521</span></span>
<span><span class="co">#&gt; 4: 12010,34130 12050,34110 -0.1442108</span></span>
<span><span class="co">#&gt; 5: 12010,34130 12030,34090 -2.8067932</span></span>
<span><span class="co">#&gt; 6: 12030,34130 12010,34130 -0.8184357</span></span></code></pre></div>
<p>There are three columns. <code>$from</code> and <code>$to</code> contain the x and y coordinates for the start and stop of each possible movement/transition. These are stored as character strings, with a precision of up to two decimal points depending on the resolution and origin. <code>$dz</code> contains the change in elevation encountered when traveling from the <code>$from</code> cell to the <code>$to</code> cell.</p>
<p>The next step is calculating the cost in terms of time, work, and energy for every possible transition. The <code>calculateCosts</code> function takes the changes in elevation and using the velocity information from the previous section, models of biomechanical work expenditure, and physical limitations calculates the expected costs. There are currently three available models, run <code><a href="reference/calculateCosts.html">?calculateCosts</a></code> for more information on each model and what parameters are required. This is for a 60 kg human with a maximum walking speed of 1.5 m/s, a leg length of 80 cm, a stride length of 1.6 m, a BMR of 93 J/s, and canonical values for Tobler’s hiking function:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calculateCosts.html">calculateCosts</a></span><span class="op">(</span>world <span class="op">=</span> <span class="va">world</span>, method <span class="op">=</span> <span class="st">'kuo'</span>, m <span class="op">=</span> <span class="fl">60</span>, v_max <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>                        BMR <span class="op">=</span> <span class="fl">93</span>, k <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="op">-</span><span class="fl">0.05</span>, l_s <span class="op">=</span> <span class="fl">1.6</span>, L <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p>Note that we could simply have done <code>v_max = velocity$vmax, alpha = velocity$alpha, k = velocity$k</code>, but the current <code>velocity</code> object was generated with random data and thus the parameters are nonsensical. Taking a look at the <code>world</code> object now shows an additional nine columns:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span></span>
<span><span class="co">#&gt;           from          to         dz   x_i   y_i       dl     dl_t       dt     dU_l      dK_l      dW_l      dE_l</span></span>
<span><span class="co">#&gt; 1: 12010,34130 12030,34130  0.8184357 12010 34130 20.00000 1.141907 17.51456 481.7312  977.9639  7298.476  8927.330</span></span>
<span><span class="co">#&gt; 2: 12010,34130 12010,34110 -1.7999878 12010 34130 20.00000 1.330383 15.03326   0.0000 1327.4394  6637.197  8035.290</span></span>
<span><span class="co">#&gt; 3: 12010,34130 12030,34110 -0.9815521 12010 34130 28.28427 1.432720 19.74167   0.0000 2177.2016 10886.008 12721.983</span></span>
<span><span class="co">#&gt; 4: 12010,34130 12050,34110 -0.1442108 12010 34130 44.72136 1.303612 34.30572   0.0000 2849.9886 14249.943 17440.375</span></span>
<span><span class="co">#&gt; 5: 12010,34130 12030,34090 -2.8067932 12010 34130 44.72136 1.443657 30.97782   0.0000 3495.2198 17476.099 20357.037</span></span>
<span><span class="co">#&gt; 6: 12030,34130 12010,34130 -0.8184357 12030 34130 20.00000 1.459699 13.70145   0.0000 1598.0415  7990.208  9264.443</span></span></code></pre></div>
<p><code>$x_i</code> and <code>$y_i</code> give the numeric x and y coordinates of the first part of the movement/transition. <code>$dl</code> gives the distance, <code>$dl_t</code> the predicted speed, <code>$dt</code> the predicted amount of time spent making that movement, <code>$dU_l</code> the work performed against gravity, <code>$dK_l</code> the kinematic work performed, <code>$dW_l</code> the net mechanical work performed, and <code>$dE_l</code> the total energetic/metabolic expenditure.</p>
</div>
<div class="section level3">
<h3 id="part-4-getting-costs-paths-and-corridors">Part 4: Getting Costs, Paths, and Corridors<a class="anchor" aria-label="anchor" href="#part-4-getting-costs-paths-and-corridors"></a>
</h3>
<p>The final part of the workflow involves calculating the minimum cost and/or least-cost path between two sets of points. Generally the first step in this process is running the <code>getCosts</code> function, with the parameters set based on your needs:</p>
<ol style="list-style-type: decimal">
<li>If you simply desire the distance between two sets of points (cases 1 and 2), provide entries for <code>from</code> and <code>to</code> (or just <code>from</code> if the interest is in all distances between locations in that object). Output is a distance matrix. The computational time for this operation is comparable to generating a raster for the distance to all cells in the world (unless all of the locations in the object are close to each other). So unless the operation is to be done multiple times, it is highly recommended to generate the raster as below and extract values:</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate five random points that fall within the region</span></span>
<span><span class="va">points</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>                     x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fu">extent</span><span class="op">(</span><span class="va">region</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu">extent</span><span class="op">(</span><span class="va">region</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                     y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fu">extent</span><span class="op">(</span><span class="va">region</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fu">extent</span><span class="op">(</span><span class="va">region</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>                     </span>
<span><span class="co"># Get the cost for travel between all combination of points</span></span>
<span><span class="va">costMatrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getCosts.html">getCosts</a></span><span class="op">(</span>world <span class="op">=</span> <span class="va">world</span>, from <span class="op">=</span> <span class="va">points</span>, z_fix <span class="op">=</span> <span class="va">dem</span>,</span>
<span>                       costs <span class="op">=</span><span class="st">'all'</span>, direction <span class="op">=</span> <span class="st">'out'</span>, dir <span class="op">=</span> <span class="va">dir</span><span class="op">)</span></span></code></pre></div>
<p>The output will be a list of cost matrices, with elements named after the type of costand direction of travel:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">costMatrix</span><span class="op">)</span></span>
<span><span class="co">#&gt; $time_out</span></span>
<span><span class="co">#&gt;        To_ID</span></span>
<span><span class="co">#&gt; From_ID        1        2        3        4        5</span></span>
<span><span class="co">#&gt;       1    0.000 3785.938 2568.529 2076.004 2310.362</span></span>
<span><span class="co">#&gt;       2 3050.684    0.000 1570.530 2929.603 1580.320</span></span>
<span><span class="co">#&gt;       3 1961.597 2038.679    0.000 3089.954 2039.565</span></span>
<span><span class="co">#&gt;       4 1945.193 3520.094 3380.561    0.000 1921.295</span></span>
<span><span class="co">#&gt;       5 1711.558 1684.172 1659.327 1423.330    0.000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $work_out</span></span>
<span><span class="co">#&gt;        To_ID</span></span>
<span><span class="co">#&gt; From_ID         1         2         3         4         5</span></span>
<span><span class="co">#&gt;       1       0.0 1692662.5 1083922.5  942510.9 1044711.7</span></span>
<span><span class="co">#&gt;       2 1202161.7       0.0  750423.6 1223106.8  721523.5</span></span>
<span><span class="co">#&gt;       3  927981.8  871342.2       0.0 1347879.8  865893.2</span></span>
<span><span class="co">#&gt;       4  861407.5 1592498.3 1456959.0       0.0  856901.6</span></span>
<span><span class="co">#&gt;       5  611075.4  774201.1  806600.5  569726.0       0.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $energy_out</span></span>
<span><span class="co">#&gt;        To_ID</span></span>
<span><span class="co">#&gt; From_ID         1         2         3         4         5</span></span>
<span><span class="co">#&gt;       1       0.0 2052520.1 1322795.7 1139740.5 1259575.3</span></span>
<span><span class="co">#&gt;       2 1501162.6       0.0  908436.4 1502262.5  869120.5</span></span>
<span><span class="co">#&gt;       3 1131515.0 1060939.3       0.0 1651101.7 1058009.8</span></span>
<span><span class="co">#&gt;       4 1046297.7 1923020.9 1776951.6       0.0 1035582.0</span></span>
<span><span class="co">#&gt;       5  770250.3  930829.0  976948.6  702095.7       0.0</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p>If you wish to generate a RasterStack of costs from and/or to all nodes in the from object, set the <code>output = 'object'</code> and <code>destination = 'all'</code>.</p></li>
<li><p>You may also save the rasters as a series of <code>tif</code> files in the same workspace directory as the transition <code>gz</code> tensor files and the cropped/downloaded DEMs. This allows us to use <code>getCosts</code> within a loop for large numbers of origin nodes without running into random access memory limitations. Do this by setting <code>output = 'file'</code> and <code>destination = 'all'</code>.</p></li>
<li><p>You may perform (2) and (3) simultaneously by setting <code>output = c('file','object')</code> and <code>destination = 'all'</code>.</p></li>
</ol>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the cost rasters to travel to and from a set of points</span></span>
<span><span class="va">costRasters</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getCosts.html">getCosts</a></span><span class="op">(</span>world <span class="op">=</span> <span class="va">world</span>, from <span class="op">=</span> <span class="va">points</span>, z_fix <span class="op">=</span> <span class="va">dem</span>,</span>
<span>                        destination <span class="op">=</span> <span class="st">'all'</span>, costs <span class="op">=</span> <span class="st">'all'</span>,</span>
<span>                        output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"object"</span>,<span class="st">"file"</span><span class="op">)</span>, dir <span class="op">=</span> <span class="va">dir</span><span class="op">)</span></span></code></pre></div>
<p>Let’s take a look at the structure of the costRasters:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="va">costRasters</span><span class="op">)</span></span>
<span><span class="co">#&gt; $time_in</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 202, 202, 40804, 5  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 20, 20  (x, y)</span></span>
<span><span class="co">#&gt; extent     : 12000, 16040, 32000, 36040  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=lcc +lat_0=0 +lon_0=-100 +lat_1=48 +lat_2=33 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs </span></span>
<span><span class="co">#&gt; names      :     To_1,     To_4,     To_5,     To_3,     To_2 </span></span>
<span><span class="co">#&gt; min values :        0,        0,        0,        0,        0 </span></span>
<span><span class="co">#&gt; max values : 3826.432, 4506.113, 3700.125, 3638.810, 4838.098 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $time_out</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 202, 202, 40804, 5  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 20, 20  (x, y)</span></span>
<span><span class="co">#&gt; extent     : 12000, 16040, 32000, 36040  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=lcc +lat_0=0 +lon_0=-100 +lat_1=48 +lat_2=33 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs </span></span>
<span><span class="co">#&gt; names      :   From_1,   From_4,   From_5,   From_3,   From_2 </span></span>
<span><span class="co">#&gt; min values :        0,        0,        0,        0,        0 </span></span>
<span><span class="co">#&gt; max values : 4336.080, 4417.912, 2741.120, 3259.288, 3728.537 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $work_in</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 202, 202, 40804, 5  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 20, 20  (x, y)</span></span>
<span><span class="co">#&gt; extent     : 12000, 16040, 32000, 36040  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=lcc +lat_0=0 +lon_0=-100 +lat_1=48 +lat_2=33 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs </span></span>
<span><span class="co">#&gt; names      :    To_1,    To_4,    To_5,    To_3,    To_2 </span></span>
<span><span class="co">#&gt; min values :       0,       0,       0,       0,       0 </span></span>
<span><span class="co">#&gt; max values : 1563957, 1958144, 1664177, 1550179, 2150581 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $work_out</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 202, 202, 40804, 5  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 20, 20  (x, y)</span></span>
<span><span class="co">#&gt; extent     : 12000, 16040, 32000, 36040  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=lcc +lat_0=0 +lon_0=-100 +lat_1=48 +lat_2=33 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs </span></span>
<span><span class="co">#&gt; names      :  From_1,  From_4,  From_5,  From_3,  From_2 </span></span>
<span><span class="co">#&gt; min values :       0,       0,       0,       0,       0 </span></span>
<span><span class="co">#&gt; max values : 1916192, 1948730, 1219162, 1446797, 1460012 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $energy_in</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 202, 202, 40804, 5  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 20, 20  (x, y)</span></span>
<span><span class="co">#&gt; extent     : 12000, 16040, 32000, 36040  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=lcc +lat_0=0 +lon_0=-100 +lat_1=48 +lat_2=33 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs </span></span>
<span><span class="co">#&gt; names      :    To_1,    To_4,    To_5,    To_3,    To_2 </span></span>
<span><span class="co">#&gt; min values :       0,       0,       0,       0,       0 </span></span>
<span><span class="co">#&gt; max values : 1928774, 2388734, 2008291, 1894229, 2602716 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $energy_out</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 202, 202, 40804, 5  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 20, 20  (x, y)</span></span>
<span><span class="co">#&gt; extent     : 12000, 16040, 32000, 36040  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=lcc +lat_0=0 +lon_0=-100 +lat_1=48 +lat_2=33 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs </span></span>
<span><span class="co">#&gt; names      :  From_1,  From_4,  From_5,  From_3,  From_2 </span></span>
<span><span class="co">#&gt; min values :       0,       0,       0,       0,       0 </span></span>
<span><span class="co">#&gt; max values : 2326474, 2370636, 1489674, 1760632, 1821267</span></span></code></pre></div>
<p>It’s a list of RasterStacks, each in a slot named after the type of cost (time, work, or energy) and the direction of travel (out from a node, or in to a node). Each RasterStack has one layer for each node, with the value at each point in the RasterLayer representing the absolute minimum cost necessary to travel between that given node to/from that given point.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">costRasters</span><span class="op">$</span><span class="va">time_in</span><span class="op">[[</span><span class="st">'To_5'</span><span class="op">]</span><span class="op">]</span>,main<span class="op">=</span><span class="st">'Time in Seconds to Travel to Point 5'</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-raster-plot-1.png" width="100%"> Since <code>'file'</code> was also listed in the <code>output</code> parameter for <code>getCosts</code>, the raster files were also exported to a <code>'CostRasters'</code> folder in <code>dir</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html" class="external-link">normalizePath</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir</span>,<span class="st">"/CostRasters"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Energy_From_1.tif" "Energy_From_2.tif" "Energy_From_3.tif" "Energy_From_4.tif" "Energy_From_5.tif"</span></span>
<span><span class="co">#&gt;  [6] "Energy_To_1.tif"   "Energy_To_2.tif"   "Energy_To_3.tif"   "Energy_To_4.tif"   "Energy_To_5.tif"  </span></span>
<span><span class="co">#&gt; [11] "Time_From_1.tif"   "Time_From_2.tif"   "Time_From_3.tif"   "Time_From_4.tif"   "Time_From_5.tif"  </span></span>
<span><span class="co">#&gt; [16] "Time_To_1.tif"     "Time_To_2.tif"     "Time_To_3.tif"     "Time_To_4.tif"     "Time_To_5.tif"    </span></span>
<span><span class="co">#&gt; [21] "Work_From_1.tif"   "Work_From_2.tif"   "Work_From_3.tif"   "Work_From_4.tif"   "Work_From_5.tif"  </span></span>
<span><span class="co">#&gt; [26] "Work_To_1.tif"     "Work_To_2.tif"     "Work_To_3.tif"     "Work_To_4.tif"     "Work_To_5.tif"</span></span></code></pre></div>
<p>These rasters—be they stored as an object on the memory with <code>'object' %in% output</code> or on the hard drive with <code>'file' %in% output'</code> are required to compute cost corridors. For a given series of origins and destinations (e.g. A -&gt; B -&gt; C) a cost raster gives the absolute minimum expectedtotal cost that would be required to route the path through any given point on the landscape. The cells with the lowest value correspond to the least-cost path, while the value of all other cells minus the lowest value represents the cost to perform a SINGLE detour to any given location from the least-cost path. These rasters can be generated with the <code>makeCorridor</code> function:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculating the corridors from a list of RasterStacks,</span></span>
<span><span class="co"># with path 1 -&gt; 2 -&gt; 4 -&gt; 1 -&gt; 5</span></span>
<span><span class="va">pathOrder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">corridors</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/makeCorridor.html">makeCorridor</a></span><span class="op">(</span>rasters <span class="op">=</span> <span class="va">dir</span>, order <span class="op">=</span> <span class="va">pathOrder</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">corridors</span><span class="op">$</span><span class="va">time</span> <span class="op">-</span> <span class="fu">minValue</span><span class="op">(</span><span class="va">corridors</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>, </span>
<span>     main <span class="op">=</span> <span class="st">'Minimum detour in Seconds to add a given point on the</span></span>
<span><span class="st">     landscape to the path 1 -&gt; 2 -&gt; 5 -&gt; 1 -&gt; 4'</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-corridor-1.png" width="100%"></p>
<p>We could also have used the parameter <code>rasters = costRasters</code> since <code>makeCorridor</code> accepts the object output of <code>getCosts</code> as its input. Note that the names of the nodes listed in <code>order</code> must correspond to the names of the nodes used in the <code>from</code> column of the <code>getCosts</code> function. Due to carried floats it is insufficient to simply select all values corresponding to the minimum cost to identify the least-cost path. Fortunately, the <code>getPaths</code> function can generate a list of SpatialLinesDataFrame objects corresponding to the least-cost paths:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getPaths.html">getPaths</a></span><span class="op">(</span>world <span class="op">=</span> <span class="va">world</span>, nodes <span class="op">=</span> <span class="va">points</span>, z_fix <span class="op">=</span> <span class="va">dem</span>, order <span class="op">=</span> <span class="va">pathOrder</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># re-plot the corridors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">corridors</span><span class="op">$</span><span class="va">time</span> <span class="op">-</span> <span class="fu">minValue</span><span class="op">(</span><span class="va">corridors</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>, </span>
<span>     main <span class="op">=</span> <span class="st">'Least-Cost-Path for route 1 -&gt; 2 -&gt; 5 -&gt; 1 -&gt; 4'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">paths</span><span class="op">$</span><span class="va">time</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-paths-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="section level3">
<h3 id="for-energetic-and-temporal-cost-calculations">For Energetic and Temporal Cost Calculations<a class="anchor" aria-label="anchor" href="#for-energetic-and-temporal-cost-calculations"></a>
</h3>
<p>Assuming that we have (1) generated a <code>dem</code>, (2) location <code>points</code>, (3) high-resolution locational <code>data</code> representing the XY location of an animal, and (4) a <code>region</code> of interest lying within the <code>dem</code>’s extent, the minimum required workflow to get the velocity function, cost rasters for a set of location points, a corridor between some or all of them, and the least cost path is:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Start by making the grid:</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/makeGrid.html">makeGrid</a></span><span class="op">(</span>dem <span class="op">=</span> <span class="va">dem</span>, nx <span class="op">=</span> <span class="va">n</span>, ny <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="co"># Or you can employ a grid from an alternate source pointing to</span></span>
<span><span class="co"># filepaths or URLs from which to download data</span></span>
<span></span>
<span></span>
<span><span class="co"># Get the velocity function</span></span>
<span><span class="va">velocity</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getVelocity.html">getVelocity</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, z <span class="op">=</span> <span class="va">grid</span>, dir <span class="op">=</span> <span class="va">dir</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the transitional costs to move between each allowable cells.</span></span>
<span><span class="co"># Replace the v_max, alpha, and k parameters with known values if appropriate,</span></span>
<span><span class="co"># and make sure all other parameters are representative for your species of interest</span></span>
<span><span class="va">world</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calculateCosts.html">calculateCosts</a></span><span class="op">(</span>world <span class="op">=</span> <span class="va">grid</span>, m <span class="op">=</span> <span class="fl">60</span>, v_max <span class="op">=</span> <span class="va">velocity</span><span class="op">$</span><span class="va">vmax</span>,</span>
<span>                        k <span class="op">=</span> <span class="va">velocity</span><span class="op">$</span><span class="va">k</span>, alpha <span class="op">=</span> <span class="va">velocity</span><span class="op">$</span><span class="va">alpha</span>, BMR <span class="op">=</span> <span class="fl">93</span>,</span>
<span>                        l_s <span class="op">=</span> <span class="fl">1.6</span>, L <span class="op">=</span> <span class="fl">0.8</span>, region <span class="op">=</span> <span class="va">region</span>, z_fix <span class="op">=</span> <span class="va">dem</span>,</span>
<span>                        cut_slope <span class="op">=</span> <span class="fl">0.5</span>, dir <span class="op">=</span> <span class="va">dir</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the total costs for the least-cost path between any point on the landscape</span></span>
<span><span class="co"># and all of the nodes; export as rasters but don't keep the object</span></span>
<span><span class="fu"><a href="reference/getCosts.html">getCosts</a></span><span class="op">(</span>world <span class="op">=</span> <span class="va">world</span>, from <span class="op">=</span> <span class="va">points</span>, z_fix <span class="op">=</span> <span class="va">dem</span>, destination <span class="op">=</span> <span class="st">'all'</span>,</span>
<span>         output <span class="op">=</span> <span class="st">'file'</span>, dir <span class="op">=</span> <span class="va">dir</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the corridors for the path between nodes 1 -&gt; 2 -&gt; 5 -&gt; 1 -&gt; 4</span></span>
<span><span class="va">pathOrder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">corridors</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/makeCorridor.html">makeCorridor</a></span><span class="op">(</span>rasters <span class="op">=</span> <span class="va">dir</span>, order <span class="op">=</span> <span class="va">pathOrder</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get that same least-cost path</span></span>
<span><span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getPaths.html">getPaths</a></span><span class="op">(</span>world <span class="op">=</span> <span class="va">world</span>, nodes <span class="op">=</span> <span class="va">points</span>, z_fix <span class="op">=</span> <span class="va">dem</span>, order <span class="op">=</span> <span class="va">pathOrder</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="custom-cost-functions-and-multivariate-costs">Custom Cost Functions and Multivariate Costs<a class="anchor" aria-label="anchor" href="#custom-cost-functions-and-multivariate-costs"></a>
</h3>
<p>It’s also possible to employ costs that aren’t directly a function of the difference in elevation between two points. This could be because the employed raster does not represent heights (such as a landcover raster), or because the required values are the raw ones (not just the difference). Neither case prohibits use of the workflow in Part 1. In such situations, it’s important to bear in mind that <code>$dz</code> represents that difference in value. When the raw values are needed, the <code>keep_z</code> parameter in <code>makeWorld</code> should be a character vector including <code>c('z_i','z_f')</code>, and also <code>dz</code> when the difference between them is needed. If the raster is categorical (such as those representing discrete landcover types), <code>dz</code> should be omitted. In the event of a tie in mosaicing rasters, we’ll select the highest integer value (<code>FUN = max</code>). Don’t forget to set <code>sampling = 'ngb'</code> if the data is categorical and thus it’s inappropriate to employ the default <code>'bilinear'</code> interpolation. If the origin x or y coordinates are needed, the <code>xy1</code> parameter in <code>importWorld</code> should be set to <code>TRUE</code>, and likewise for the destination coordinates and <code>xy2</code> parameter. If the distance between the origin and destination are needed, <code>dl = TRUE</code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a categorical DEM</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">dem2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>                        y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span></span>
<span><span class="va">dem2</span> <span class="op">&lt;-</span> <span class="fu">as.data.table</span><span class="op">(</span><span class="va">dem2</span><span class="op">)</span></span>
<span><span class="va">dem2</span><span class="op">[</span>, <span class="va">z</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dem2</span><span class="op">)</span>,replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">dem2</span> <span class="op">&lt;-</span> <span class="fu">rasterFromXYZ</span><span class="op">(</span><span class="va">dem2</span><span class="op">)</span></span>
<span><span class="fu">extent</span><span class="op">(</span><span class="va">dem2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10000</span>, <span class="fl">20000</span>, <span class="fl">30000</span>, <span class="fl">40000</span><span class="op">)</span></span>
<span><span class="fu">crs</span><span class="op">(</span><span class="va">dem2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"+proj=lcc +lat_1=48 +lat_2=33 +lon_0=-100 +datum=WGS84"</span></span>
<span></span>
<span><span class="co"># Export it so it doesn't just exist on the memory</span></span>
<span><span class="va">dir2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html" class="external-link">normalizePath</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"/Categorical"</span><span class="op">)</span>,mustWork<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">dir2</span>,showWarnings<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">writeRaster</span><span class="op">(</span><span class="va">dem2</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir2</span>,<span class="st">"/DEM2.tif"</span><span class="op">)</span>,format<span class="op">=</span><span class="st">"GTiff"</span>,overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import raster, get the grid</span></span>
<span><span class="va">dem2</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir2</span>,<span class="st">"/DEM2.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">grid2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/makeGrid.html">makeGrid</a></span><span class="op">(</span>dem <span class="op">=</span> <span class="va">dem2</span>, nx <span class="op">=</span> <span class="va">n</span>, ny <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="va">world2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/importWorld.html">importWorld</a></span><span class="op">(</span>region <span class="op">=</span> <span class="va">region</span>, polys <span class="op">=</span> <span class="va">grid2</span>, cut_slope <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>                      z_fix <span class="op">=</span> <span class="va">dem</span>, keep_z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z_i"</span>,<span class="st">"z_f"</span><span class="op">)</span>, dl <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                      FUN <span class="op">=</span> <span class="va">max</span>, sampling <span class="op">=</span> <span class="st">'ngb'</span>, dir <span class="op">=</span> <span class="va">dir2</span><span class="op">)</span></span></code></pre></div>
<p>Let’s take a look at the structure of this new world data.table</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">world2</span><span class="op">)</span></span>
<span><span class="co">#&gt;           from          to z_i z_f       dl</span></span>
<span><span class="co">#&gt; 1: 12010,34130 12030,34130   3   4 20.00000</span></span>
<span><span class="co">#&gt; 2: 12010,34130 12010,34110   3   2 20.00000</span></span>
<span><span class="co">#&gt; 3: 12010,34130 12030,34110   3   3 28.28427</span></span>
<span><span class="co">#&gt; 4: 12010,34130 12050,34110   3   3 44.72136</span></span>
<span><span class="co">#&gt; 5: 12010,34130 12030,34090   3   2 44.72136</span></span>
<span><span class="co">#&gt; 6: 12030,34130 12010,34130   4   3 20.00000</span></span></code></pre></div>
<p>Unlike the output of <code>importWorld</code> above, this contains five columns, only sharing in common the <code>$from</code> and <code>$to</code> columns.Let’s pretend that this raster represents landtypes, and for some reason travel between cells of the same landcover type are prohibited. Bearing in mind that since <code>distance = 16</code> a traveler could ‘hop’ over a single barrier cell, we can still apply that condition using a simple data.table expression:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world2</span> <span class="op">&lt;-</span> <span class="va">world2</span><span class="op">[</span><span class="va">z_i</span> <span class="op">!=</span> <span class="va">z_f</span>, <span class="op">]</span></span></code></pre></div>
<p>This drops all entries where <code>z_i == z_f</code>. Now let’s calculate some imaginary costs. Let’s say that the cost to travel from one landcover type to another is square of the origin landcover class integer times the destination class integer divided by the distance between the cells <code>dl</code>:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world2</span><span class="op">[</span>, <span class="va">fakeCost</span> <span class="op">:=</span> <span class="va">z_i</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">z_f</span> <span class="op">/</span> <span class="va">dl</span><span class="op">]</span></span></code></pre></div>
<p>Since we’ve used the same <code>z_fix</code> and <code>precision</code> values, any overlapping sections will have the same cell names as the example in Part 3. Thus, we can calculate different types of costs based on different types of landscape variables. For example, if the total cost function we’re interested is the product of <code>$fakeCost</code> from above and the gravitational potential energy <code>$dU_l</code> from part 3 we just need to merge the <code>world</code> data.tables, calculate the total cost, and run <code>getCosts</code>, <code>makeCorridor</code>, and <code>getPaths</code> as above but specifying the new cost name.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Merge the worlds</span></span>
<span><span class="va">world3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">world</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">from</span>,<span class="va">to</span>,<span class="va">dU_l</span><span class="op">)</span><span class="op">]</span>,           <span class="co"># Keep cell names</span></span>
<span>                <span class="va">world2</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">from</span>,<span class="va">to</span>,<span class="va">fakeCost</span><span class="op">)</span><span class="op">]</span>,      <span class="co"># and costs, join</span></span>
<span>                by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"from"</span>,<span class="st">"to"</span><span class="op">)</span>, all<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>      <span class="co"># on the latter two</span></span>
<span>                                                           </span>
<span></span>
<span><span class="co"># Calculate our multivariate cost</span></span>
<span><span class="va">world3</span><span class="op">[</span>, <span class="va">newCost</span> <span class="op">:=</span> <span class="va">fakeCost</span> <span class="op">*</span> <span class="va">dU_l</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Get the total costs for the least-cost path between any point on the landscape</span></span>
<span><span class="co"># and all of the nodes; export as rasters but don't keep the object</span></span>
<span><span class="fu"><a href="reference/getCosts.html">getCosts</a></span><span class="op">(</span>world <span class="op">=</span> <span class="va">world3</span>, from <span class="op">=</span> <span class="va">points</span>, z_fix <span class="op">=</span> <span class="va">dem</span>, destination <span class="op">=</span> <span class="st">'all'</span>,</span>
<span>         output <span class="op">=</span> <span class="st">'file'</span>, costs<span class="op">=</span><span class="st">'newCost'</span>, dir <span class="op">=</span> <span class="va">dir2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the corridors for the path between nodes 1 -&gt; 2 -&gt; 5 -&gt; 1 -&gt; 4</span></span>
<span><span class="va">pathOrder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">corridors</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/makeCorridor.html">makeCorridor</a></span><span class="op">(</span>rasters <span class="op">=</span> <span class="va">dir2</span>, order <span class="op">=</span> <span class="va">pathOrder</span>, cost<span class="op">=</span><span class="st">'newCost'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get that same least-cost path</span></span>
<span><span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getPaths.html">getPaths</a></span><span class="op">(</span>world <span class="op">=</span> <span class="va">world3</span>, nodes <span class="op">=</span> <span class="va">points</span>, z_fix <span class="op">=</span> <span class="va">dem</span>, </span>
<span>                  order <span class="op">=</span> <span class="va">pathOrder</span>, cost<span class="op">=</span><span class="st">'newCost'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">corridors</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">paths</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-finalCosts-quiet-1.png" width="100%"></p>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://creativecommons.org/licenses/by-nc/4.0" class="external-link">CC BY-NC 4.0</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing lbmech</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Andres G. Mejia Ramon <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Andres G. Mejia Ramon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
